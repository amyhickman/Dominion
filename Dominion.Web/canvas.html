<html>
<head>
	<script type="text/javascript" src="Scripts/easel.js"></script>
	<script type="text/javascript">
		var canvas;
		var stage;
		var mouseTarget;
		var dragStarted;
		var offset = new Point();
		
		function init() {
			canvas = document.getElementById('foo');
			stage = new Stage(canvas);
			stage.mouseEnabled = true;
			
			// attach mouse handlers directly to the source canvas:
			stage.onmousemove = onMouseMove;
			canvas.onmousedown = onMouseDown;
			canvas.onmouseup = onMouseUp;

			// load the source image:
			var image = new Image();
			image.src = "daisy.png";
			image.onload = handleImageLoad;
		};
		
		function handleImageLoad(event) {
			var image = event.target;
			var bitmap;
			var container = new Container();
			stage.addChild(container);
	
			bitmap = new Bitmap(image);
			bitmap.x = canvas.width * Math.random()|0;
			bitmap.y = canvas.height * Math.random()|0;
			bitmap.regX = bitmap.image.width/2|0;
			bitmap.regY = bitmap.image.height/2|0;
			bitmap.scaleX = bitmap.scaleY = bitmap.scale = 1;//Math.random()+0.6;
			bitmap.mouseEnabled = true;
			container.addChild(bitmap);

			// assign a tick listener directly to this window:
			Ticker.addListener(window);
		}

		function tick() {
			// if we were dragging, but are not anymore, call mouseOut with the old target:
			if(!dragStarted && mouseTarget){ 
				onMouseOut(mouseTarget); 
				dragStarted = false;
			}
			
			// if we're not currently dragging, and have valid mouseX and mouseY values, check for objects under mouse:
			if(!dragStarted && stage.mouseX && stage.mouseY){
				// when running local files, most browsers throw a security error when reading pixel data
				// (which getObjectUnderPoint uses) so we'll put it in a try/catch block:

				var t = (new Date()).getTime();
					mouseTarget = stage.getObjectUnderPoint(stage.mouseX, stage.mouseY);
				try {
					// this will return the top-most display object under the mouse position:
				} catch (e) {
					Ticker.removeListener(window);
					alert("An error occurred because this browser does not support reading pixel data in local files. Please read 'SECURITY_ERROR_README.txt' included with the EaselJS for details");
				}
				if(mouseTarget){
					// if we found a target, call mouseOver with it:
					onMouseOver(mouseTarget);
					offset.x = mouseTarget.x-stage.mouseX;
					offset.y = mouseTarget.y-stage.mouseY;
				}
			}
	
			// if we're currently dragging something, update it's x/y:
			if(dragStarted && mouseTarget){
				// pop it to the top of the display list:
				stage.addChild(mouseTarget);
				mouseTarget.x = stage.mouseX+offset.x;
				mouseTarget.y = stage.mouseY+offset.y;
			}
			
			//Update the display list (draw everything)
			stage.update();

		}

		
	
		// on mouse move, update the stage's mouseX/mouseY:
		function onMouseMove(e) {
			if(!e){ e = window.event; }
			stage.mouseX = e.pageX-canvas.offsetLeft;
			stage.mouseY = e.pageY-canvas.offsetTop;
		}

		// set flag to indicate we want to drag whatever is under the mouse:
		function onMouseDown() {
			if(!e){ var e = window.event; }
			dragStarted = true;
		}

		// set flag to indicate we no longer want to drag:
		function onMouseUp() {
			dragStarted = false;
		}

		// scale Display Objects on mouseOver / Out:
		function onMouseOver(target){
			target.scaleX = target.scaleY = target.scale * 1.1;
		}

		function onMouseOut(target){
			target.scaleX = target.scaleY = target.scale; 
		}

	</script>
</head>
<body onload="init()">
	<canvas id="foo" width="1000px" height="800px">
	Your browser doesn't support canvas
	</canvas>


</body>
</html>